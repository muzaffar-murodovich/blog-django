{% extends "base.html" %}
{% load static %}
{% load hitcount_tags %} 

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
    <div class="post-detail">
        <h1>{{ post.title }}</h1>
        <p class="post-meta">
            Muallif: {{ post.author.username }} | 
            Kategoriya: <a href="{% url 'category_posts' post.category.slug %}">{{ post.category.name }}</a> | 
            Chop etilgan vaqti: {{ post.created_at|date:"Y-m-d H:i" }} |
            Ko'rildi: {% get_hit_count for post %} marta |
            Izohlar: {{ comment_count }} ta |
            {{ reading_time }} daqiqada o'qiladi | 
        
        {% if user.is_authenticated and post.author == user %}
            <a href="{% url 'update_post' post.slug %}" class="btn btn-primary">Tahrirlash</a> | 
            <a href="{% url 'delete_post' post.slug %}" class="btn btn-danger">O'chirish</a>
        {% endif %}
        </p>
        {% if post.image %}
            <img src="{{ post.image.url }}" alt="{{ post.title }}" style="max-width: 100%; height: auto; margin-bottom: 20px;">
        {% endif %}

        <div class="post-content">
            {{ post.content|linebreaksbr }} 
        </div>

        {% if post.tags.all %}
            <p class="post-tags">
                Teglar: {% for tag in post.tags.all %}
                    <a href="{% url 'tag_posts' tag.slug %}" class="tag">#{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </p>
        {% endif %}

        <hr>

        <div class="comments-section">
            <h3>Izohlar ({{ post.comments.count }})</h3>
            
            {% for comment in post.comments.all %}
                <div class="comment">
                    <p class="comment-author">
                        {{ comment.author.username }} - {{ comment.created_at}} da:
                    </p>
                    <p class="comment-text">{{ comment.text }}</p>
                </div>
                <hr>
            {% empty %}
                <p>Hozircha izohlar mavjud emas. Birinchi bo'lishingiz mumkin!</p>
            {% endfor %}

            {% if user.is_authenticated %}
            <h4>Izoh qoldirish</h4>
            <form method="post" action="">
                {% csrf_token %}
                {{ form.as_p }} 
                <button type="submit">Izoh Yuborish</button>
            </form>
            {% else %}
                <p>Izoh qoldirish uchun <a href="{% url 'register' %}">roʻyxatdan oʻting</a> yoki <a href="{% url 'login' %}">tizimga kiring</a>.</p>
            {% endif %}
        </div>
    </div>
{% endblock %}